<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Earphone Lab v7.0 | ã‚¨ãƒ¼ã‚¸ãƒ³ã‚°ï¼†ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªç·åˆãƒ†ã‚¹ãƒˆ</title>
    <meta name="description" content="ã‚¤ãƒ¤ãƒ›ãƒ³ã®ãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«ã‚’è§£æ”¾ã›ã‚ˆã€‚ã‚¨ãƒ¼ã‚¸ãƒ³ã‚°ã€å‘¨æ³¢æ•°ãƒ¬ãƒ³ã‚¸ã€3DéŸ³å ´ãƒ†ã‚¹ãƒˆã¾ã§ã€‚ãƒ–ãƒ©ã‚¦ã‚¶ã§å®Œçµã™ã‚‹ãƒ—ãƒ­ä»•æ§˜ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªãƒ„ãƒ¼ãƒ«ã€‚">
    
    <!-- OGP -->
    <meta property="og:title" content="Earphone Lab v7.0 | ç©¶æ¥µã®ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªãƒ†ã‚¹ãƒˆ">
    <meta property="og:description" content="ã‚ãªãŸã®ã‚¤ãƒ¤ãƒ›ãƒ³ã¯20Hzã®é‡ä½éŸ³ã‚’å†ç”Ÿã§ãã¾ã™ã‹ï¼Ÿã‚¨ãƒ¼ã‚¸ãƒ³ã‚°ã‹ã‚‰3DéŸ³å ´ãƒ†ã‚¹ãƒˆã¾ã§ã€ã“ã®ãƒ„ãƒ¼ãƒ«ä¸€ã¤ã§å®Œçµã€‚">
    <meta name="twitter:card" content="summary_large_image">

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;900&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['"Inter"', 'sans-serif'], mono: ['"JetBrains Mono"', 'monospace'] },
                    colors: { brand: { bg: '#050505', surface: '#121212', accent: '#00dc82', text: '#f3f4f6' } },
                    animation: { 
                        'pulse-fast': 'pulse 0.1s infinite',
                        'scan': 'scan 3s linear infinite',
                        'radar': 'radar 4s linear infinite',
                        'ping-slow': 'ping 2s cubic-bezier(0, 0, 0.2, 1) infinite'
                    },
                    keyframes: { 
                        scan: { '0%': { transform: 'translateY(-100%)' }, '100%': { transform: 'translateY(100%)' } },
                        radar: { '0%': { transform: 'rotate(0deg)' }, '100%': { transform: 'rotate(360deg)' } }
                    }
                }
            }
        }
    </script>
    <style>
        body { background-color: #050505; color: #f3f4f6; touch-action: manipulation; }
        .glass-panel { background: rgba(20, 20, 20, 0.9); border: 1px solid rgba(255, 255, 255, 0.1); backdrop-filter: blur(12px); box-shadow: 0 0 40px rgba(0,0,0,0.5); position: relative; overflow: hidden; }
        
        /* Sliders */
        input[type=range] { -webkit-appearance: none; width: 100%; background: transparent; }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none; height: 24px; width: 24px; border-radius: 50%;
            background: #00dc82; cursor: pointer; margin-top: -10px;
            box-shadow: 0 0 15px rgba(0, 220, 130, 0.8); border: 2px solid #fff;
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%; height: 4px; cursor: pointer; background: #333; border-radius: 2px;
        }

        .visualizer-container { display: flex; align-items: flex-end; justify-content: center; gap: 2px; height: 40px; }
        .v-bar { width: 4px; background: #333; border-radius: 2px; transition: height 0.1s; }
        .active .v-bar { background: #00dc82; box-shadow: 0 0 10px #00dc82; }

        /* Buttons */
        .btn-primary { background: #00dc82; color: #000; font-weight: bold; transition: all 0.2s; border: 1px solid rgba(255,255,255,0.2); }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 0 20px rgba(0, 220, 130, 0.6); }
        .btn-secondary { background: transparent; color: #fff; font-weight: bold; border: 1px solid rgba(255,255,255,0.2); transition: all 0.2s; }
        .btn-secondary:hover { background: rgba(255,255,255,0.1); border-color: #fff; }
        
        .tab-btn { padding: 8px 16px; font-size: 12px; font-weight: bold; border-radius: 9999px; background: #222; color: #888; border: 1px solid #333; transition: all 0.2s; }
        .tab-btn.active { background: #00dc82; color: #000; border-color: #00dc82; box-shadow: 0 0 10px rgba(0,220,130,0.4); }

        .time-btn { padding: 4px 12px; font-size: 12px; border-radius: 6px; background: #222; color: #888; border: 1px solid #333; transition: all 0.2s; }
        .time-btn.active { background: rgba(0, 220, 130, 0.1); color: #00dc82; border-color: #00dc82; }

        .scan-line { position: absolute; left: 0; top: 0; width: 100%; height: 2px; background: rgba(0, 220, 130, 0.5); box-shadow: 0 0 10px #00dc82; animation: scan 3s linear infinite; pointer-events: none; opacity: 0; }
        .scanning .scan-line { opacity: 1; }
        
        .timer-display { font-family: 'JetBrains Mono', monospace; font-feature-settings: "tnum"; font-variant-numeric: tabular-nums; }

        /* Radar UI */
        .radar-container {
            background-image: 
                radial-gradient(circle, transparent 20%, #333 21%, transparent 22%),
                radial-gradient(circle, transparent 40%, #333 41%, transparent 42%),
                radial-gradient(circle, transparent 60%, #333 61%, transparent 62%),
                linear-gradient(0deg, transparent 49%, #333 50%, transparent 51%),
                linear-gradient(90deg, transparent 49%, #333 50%, transparent 51%);
            background-size: 100% 100%;
            touch-action: none;
        }
        .source-point {
            position: absolute; width: 24px; height: 24px; background: #00dc82; border-radius: 50%;
            box-shadow: 0 0 15px #00dc82, 0 0 30px #00dc82; transform: translate(-50%, -50%);
            cursor: grab; z-index: 10; display: flex; items-center; justify-content: center;
        }
        .source-point:active { cursor: grabbing; scale: 1.2; }
        .height-slider-track { width: 6px; height: 100%; background: #333; border-radius: 3px; position: relative; }
        .height-thumb { width: 20px; height: 20px; background: #00dc82; border-radius: 50%; position: absolute; left: 50%; transform: translate(-50%, 50%); box-shadow: 0 0 10px #00dc82; cursor: grab; border: 2px solid #fff; }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center font-sans selection:bg-emerald-500 selection:text-white pb-20">

    <div class="w-full bg-yellow-500/10 border-b border-yellow-500/20 px-4 py-2 text-center">
        <p class="text-xs text-yellow-500 font-mono font-bold flex items-center justify-center gap-2">
            <i data-lucide="volume-2" class="w-4 h-4"></i> WARNING: Set volume to LOW
        </p>
    </div>

    <div class="w-full max-w-3xl px-4 mt-8">
        
        <!-- Header -->
        <div class="text-center mb-10">
            <div class="inline-flex items-center gap-2 mb-2 text-[#00dc82]">
                <i data-lucide="waves" class="w-6 h-6"></i>
                <span class="font-mono font-bold tracking-widest">EARPHONE LAB v7.0</span>
            </div>
            <h1 class="text-3xl md:text-5xl font-black mb-4 leading-tight text-white">
                éŸ³ã‚’ã€<span class="text-[#00dc82]">å®Œå…¨æ”¯é…</span>ã™ã‚‹ã€‚
            </h1>
            <p class="text-brand-muted text-sm md:text-base">
                ã‚¨ãƒ¼ã‚¸ãƒ³ã‚°ã€å†ç”Ÿèƒ½åŠ›ã€å®šä½ã€‚<br>
                å…¨ã¦ã®æ©Ÿèƒ½ã‚’çµ±åˆã—ãŸæœ€çµ‚ãƒ†ã‚¹ãƒˆãƒ™ãƒ³ãƒã€‚
            </p>
        </div>

        <!-- 1. Burn-in (Aging) -->
        <div class="glass-panel rounded-2xl p-6 md:p-8 mb-8" id="burnin-panel">
            <div class="scan-line"></div>
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
                <h2 class="text-xl font-bold flex items-center gap-2 text-white">
                    <i data-lucide="zap" class="text-[#00dc82]"></i> BURN-IN (ã‚¨ãƒ¼ã‚¸ãƒ³ã‚°)
                </h2>
                <div class="flex gap-2 bg-black/50 p-1 rounded-full border border-white/10">
                    <button onclick="setNoise('pink')" id="n-pink" class="tab-btn active">PINK</button>
                    <button onclick="setNoise('white')" id="n-white" class="tab-btn">WHITE</button>
                    <button onclick="setNoise('brown')" id="n-brown" class="tab-btn">BROWN</button>
                </div>
            </div>
            
            <div class="mb-6 text-center">
                <div class="flex flex-wrap gap-2 justify-center mb-4">
                    <button onclick="setTimer(0)" class="time-btn active" id="t-0">âˆ ç„¡é™</button>
                    <button onclick="setTimer(15)" class="time-btn" id="t-15">15åˆ†</button>
                    <button onclick="setTimer(30)" class="time-btn" id="t-30">30åˆ†</button>
                    <button onclick="setTimer(60)" class="time-btn" id="t-60">60åˆ†</button>
                    <button onclick="setTimer(120)" class="time-btn" id="t-120">2æ™‚é–“</button>
                </div>
                <div class="text-5xl font-black text-white timer-display tracking-widest mb-1" id="timer-display">00:00:00</div>
                <div class="text-xs text-[#00dc82] h-4" id="timer-status">TARGET: INFINITE</div>
            </div>

            <div class="visualizer-container mb-6" id="burnin-vis"></div>

            <button onclick="toggleBurnIn()" id="burnin-btn" class="w-full py-4 rounded-xl font-bold text-lg flex items-center justify-center gap-3 btn-secondary">
                <i data-lucide="play" class="w-5 h-5 fill-current"></i> <span id="burnin-text">ã‚¨ãƒ¼ã‚¸ãƒ³ã‚°é–‹å§‹</span>
            </button>
            <p class="text-xs text-brand-muted text-center mt-3">â€»é€šå¸¸ã®éŸ³é‡ã‚ˆã‚Šå°‘ã—ä¸‹ã’ã¦å†ç”Ÿã—ã¦ãã ã•ã„ã€‚</p>
        </div>

        <!-- 2. Range Test -->
        <div class="glass-panel rounded-2xl p-6 md:p-8 mb-8">
            <h2 class="text-xl font-bold mb-6 flex items-center gap-2 text-white">
                <i data-lucide="activity" class="text-blue-400"></i> RANGE TEST (å†ç”Ÿèƒ½åŠ›)
            </h2>
            
            <div class="text-center mb-8">
                <div class="text-6xl font-black font-mono tracking-tighter mb-2 text-white timer-display" id="freq-display">1,000<span class="text-2xl text-brand-muted ml-2">Hz</span></div>
                <div class="inline-block bg-white/10 px-4 py-1 rounded-full text-sm font-bold text-blue-400 border border-white/10" id="range-label">Midrange</div>
            </div>

            <div class="px-2 mb-8">
                <input type="range" id="freq-slider" min="20" max="20000" step="10" value="1000" oninput="updateFreq(this.value)">
                <div class="flex justify-between text-[10px] text-brand-muted font-mono mt-3 uppercase" id="freq-labels">
                    <span>20Hz</span><span>1k</span><span>10k</span><span>20k</span>
                </div>
            </div>

            <div class="grid grid-cols-2 gap-3 mb-3">
                <button id="tone-btn" onclick="toggleTone()" class="w-full py-3 rounded-xl font-bold flex items-center justify-center gap-2 btn-secondary">
                    <i data-lucide="play" class="w-4 h-4 fill-current"></i> <span id="tone-text">ãƒˆãƒ¼ãƒ³å†ç”Ÿ</span>
                </button>
                <button id="sweep-btn" onclick="toggleSweep()" class="w-full py-3 rounded-xl font-bold flex items-center justify-center gap-2 btn-secondary bg-blue-500/10 border-blue-500/30 text-blue-300">
                    <i data-lucide="bar-chart-2" class="w-4 h-4"></i> <span id="sweep-text">Auto Sweep</span>
                </button>
            </div>
            
            <button onclick="unlockHiRes()" id="unlock-btn" class="w-full text-xs text-[#00dc82] hover:text-white border border-[#00dc82]/30 hover:border-[#00dc82] rounded-lg py-2 transition-all flex items-center justify-center gap-2 mt-2">
                <i data-lucide="zap" class="w-3 h-3"></i> é«˜ç´šã‚¤ãƒ¤ãƒ›ãƒ³è‡ªæ…¢ãƒ¢ãƒ¼ãƒ‰ (Unlock 50kHz)
            </button>
            <p class="text-xs text-brand-muted text-center mt-3">â€»20kHzä»¥ä¸Šã¯ãƒã‚¤ãƒ¬ã‚¾å¯¾å¿œæ©Ÿå™¨ã§ã®ã¿å†ç”Ÿå¯èƒ½ã§ã™ã€‚</p>
        </div>

        <!-- 3. Stereo & 3D Spatial Audio -->
        <div class="glass-panel rounded-2xl p-6 md:p-8 mb-8">
            <h2 class="text-xl font-bold mb-6 flex items-center gap-2 text-white">
                <i data-lucide="move-horizontal" class="text-purple-400"></i> STEREO / IMAGING (å®šä½)
            </h2>
            
            <!-- Basic Stereo -->
            <div class="grid grid-cols-3 gap-3 mb-4">
                <button onmousedown="playStereo('left')" onmouseup="stopStereo()" ontouchstart="playStereo('left')" ontouchend="stopStereo()" class="h-20 rounded-xl border border-white/10 hover:bg-white/5 active:bg-blue-500/20 transition-all flex flex-col items-center justify-center gap-1 group">
                    <span class="text-3xl font-black text-brand-muted group-active:text-blue-400">L</span>
                    <span class="text-[10px] font-mono text-brand-muted">Left</span>
                </button>
                <button onmousedown="playStereo('center')" onmouseup="stopStereo()" ontouchstart="playStereo('center')" ontouchend="stopStereo()" class="h-20 rounded-xl border border-white/10 hover:bg-white/5 active:bg-purple-500/20 transition-all flex flex-col items-center justify-center gap-1 group">
                    <span class="text-3xl font-black text-brand-muted group-active:text-purple-400">C</span>
                    <span class="text-[10px] font-mono text-brand-muted">Center</span>
                </button>
                <button onmousedown="playStereo('right')" onmouseup="stopStereo()" ontouchstart="playStereo('right')" ontouchend="stopStereo()" class="h-20 rounded-xl border border-white/10 hover:bg-white/5 active:bg-red-500/20 transition-all flex flex-col items-center justify-center gap-1 group">
                    <span class="text-3xl font-black text-brand-muted group-active:text-red-400">R</span>
                    <span class="text-[10px] font-mono text-brand-muted">Right</span>
                </button>
            </div>

            <button onclick="startPanning()" id="pan-btn" class="w-full py-3 rounded-xl font-bold text-sm flex items-center justify-center gap-2 btn-secondary mb-4">
                <i data-lucide="refresh-cw" class="w-4 h-4"></i> <span id="pan-text">å®šä½ç§»å‹•ãƒ†ã‚¹ãƒˆ (L â†” R)</span>
            </button>
            
            <!-- Unlock Surround -->
            <button onclick="toggleSurround()" id="surround-btn" class="w-full text-xs text-purple-400 hover:text-white border border-purple-500/30 hover:border-purple-500/80 rounded-lg py-3 transition-all flex items-center justify-center gap-2 mt-4 bg-purple-500/5">
                <i data-lucide="aperture" class="w-4 h-4"></i> Unlock 3D Spatial Audio (7.1ch/éŸ³å ´ãƒ†ã‚¹ãƒˆ)
            </button>

            <!-- Surround Panel (Hidden) -->
            <div id="surround-panel" class="hidden mt-6 pt-6 border-t border-white/10">
                <div class="flex flex-wrap gap-2 justify-center mb-4">
                    <button onclick="setSoundSource('pulse')" id="btn-pulse" class="tab-btn active text-[10px]">PULSE</button>
                    <button onclick="setSoundSource('footstep')" id="btn-footstep" class="tab-btn text-[10px]">è¶³éŸ³</button>
                    <button onclick="setSoundSource('gunshot')" id="btn-gunshot" class="tab-btn text-[10px]">éŠƒå£°</button>
                </div>

                <div class="flex justify-center items-center relative mb-4">
                    <div class="relative w-64 h-64 md:w-80 md:h-80 radar-container rounded-full border-2 border-white/20 shadow-[0_0_50px_rgba(0,220,130,0.1)]" 
                         id="radar-area"
                         ontouchstart="startDrag(event)" ontouchmove="drag(event)" ontouchend="endDrag()"
                         onmousedown="startDrag(event)" onmousemove="drag(event)" onmouseup="endDrag()" onmouseleave="endDrag()">
                        <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-white/30 pointer-events-none"><i data-lucide="user" class="w-12 h-12"></i></div>
                        <div class="absolute top-0 left-1/2 w-[1px] h-full bg-white/10 transform -translate-x-1/2 pointer-events-none"></div>
                        <div class="absolute top-1/2 left-0 w-full h-[1px] bg-white/10 transform -translate-y-1/2 pointer-events-none"></div>
                        <div id="sound-point" class="source-point" style="top: 50%; left: 50%;"><i data-lucide="volume-2" class="w-3 h-3 text-black"></i></div>
                    </div>

                    <div class="absolute right-0 top-0 bottom-0 w-10 flex flex-col items-center justify-center">
                        <div class="text-[10px] font-mono text-brand-muted mb-1">UP</div>
                        <div class="height-slider-track relative h-64 md:h-80 bg-gray-800 rounded-full">
                            <div class="absolute w-full bg-gradient-to-t from-blue-500 via-green-500 to-red-500 opacity-20 h-full rounded-full"></div>
                            <input type="range" id="elevation-slider" min="-1" max="1" step="0.1" value="0" 
                                   class="absolute top-0 left-[-10px] w-[26px] h-full opacity-0 cursor-pointer z-20" 
                                   oninput="updateElevation(this.value)" style="-webkit-appearance: slider-vertical;">
                            <div id="elevation-thumb" class="height-thumb" style="bottom: 50%;"></div>
                        </div>
                        <div class="text-[10px] font-mono text-brand-muted mt-1">DWN</div>
                    </div>
                </div>
                <p class="text-xs text-brand-muted text-center mt-2">ã‚¨ãƒªã‚¢å†…ã‚’ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦éŸ³æºç§»å‹•ã€‚å³ã®ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã§é«˜ã•èª¿æ•´ã€‚</p>
            </div>
        </div>

        <!-- Affiliate -->
        <div class="text-center mt-12">
            <div class="bg-gradient-to-r from-green-500/10 to-blue-500/10 border border-white/10 rounded-2xl p-8 mb-8">
                <h3 class="text-lg font-bold mb-2 text-white">ã€ŒéŸ³ã€ã«æº€è¶³ã—ã¦ã„ã¾ã™ã‹ï¼Ÿ</h3>
                <p class="text-sm text-brand-muted mb-6">å®šä½æ„Ÿã€è§£åƒåº¦ã€éŸ³å ´ã€‚ã™ã¹ã¦ã‚’å…¼ã­å‚™ãˆãŸãƒ‡ãƒã‚¤ã‚¹ã¯ã“ã¡ã‚‰ã€‚</p>
                <div id="rec-container" class="grid gap-4 text-left"></div>
                <div class="pt-6 border-t border-white/10 mt-6">
                    <p class="text-xs text-brand-muted mb-3 font-mono">STILL LOOKING FOR THE BEST GEAR?</p>
                    <a href="https://art2020k.github.io/my-gadget-tools/ã‚¤ãƒ¤ãƒ›ãƒ³è¨ºæ–­.html" class="group relative inline-flex items-center justify-center px-6 py-3 font-bold text-[#00dc82] transition-all duration-200 border border-[#00dc82]/30 rounded-lg hover:bg-[#00dc82]/10 hover:border-[#00dc82] hover:shadow-[0_0_15px_rgba(0,220,130,0.2)] w-full md:w-auto">
                        <i data-lucide="search" class="w-4 h-4 mr-2 group-hover:scale-110 transition-transform"></i>
                        <span>è‡ªåˆ†ã«åˆã†ã‚¤ãƒ¤ãƒ›ãƒ³ã‚’è¨ºæ–­ã™ã‚‹</span>
                        <i data-lucide="arrow-right" class="w-4 h-4 ml-2 group-hover:translate-x-1 transition-transform"></i>
                    </a>
                </div>
            </div>
            <button onclick="shareResult()" class="bg-black border border-white/20 hover:bg-white/10 text-white px-8 py-3 rounded-full text-sm font-bold transition-all flex items-center justify-center gap-2 mx-auto mb-4">
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
                çµæœã‚’Xã§ã‚·ã‚§ã‚¢
            </button>
        </div>

        <!-- Disclaimer -->
        <div class="w-full max-w-2xl mx-auto mt-8 mb-12 p-4 border border-white/10 rounded-xl text-left">
            <h4 class="text-xs font-bold text-brand-muted mb-2 flex items-center gap-2"><i data-lucide="info" class="w-3 h-3"></i> ã”åˆ©ç”¨ä¸Šã®æ³¨æ„</h4>
            <ul class="text-[10px] text-brand-muted list-disc list-inside space-y-1">
                <li>æœ¬ãƒ„ãƒ¼ãƒ«ã¯ç°¡æ˜“çš„ãªãƒ†ã‚¹ãƒˆãƒ„ãƒ¼ãƒ«ã§ã‚ã‚Šã€åŒ»ç™‚æ©Ÿå™¨ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚è´åŠ›æ¤œæŸ»ã®çµæœã‚’ä¿è¨¼ã™ã‚‹ã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</li>
                <li>å¤§éŸ³é‡ã§ã®é•·æ™‚é–“å†ç”Ÿã¯è´è¦šéšœå®³ã‚„æ©Ÿå™¨ã®ç ´æã®åŸå› ã¨ãªã‚Šã¾ã™ã€‚å¿…ãšé©åº¦ãªéŸ³é‡ã§ã”ä½¿ç”¨ãã ã•ã„ã€‚</li>
                <li>3DéŸ³å ´ãƒ†ã‚¹ãƒˆã®åŠ¹æœã¯ã€ã”ä½¿ç”¨ã®ãƒ–ãƒ©ã‚¦ã‚¶ã‚„å†ç”Ÿæ©Ÿå™¨ã®æ€§èƒ½ã«ä¾å­˜ã—ã¾ã™ã€‚</li>
                <li>Amazonã®ã‚¢ã‚½ã‚·ã‚¨ã‚¤ãƒˆã¨ã—ã¦ã€é©æ ¼è²©å£²ã«ã‚ˆã‚Šåå…¥ã‚’å¾—ã¦ã„ã¾ã™ã€‚</li>
            </ul>
        </div>

    </div>

    <script>
        lucide.createIcons();
        const AFFILIATE_ID = 'artphotograph-22';
        let audioCtx;
        function initAudio() { if(!audioCtx) { audioCtx = new (window.AudioContext || window.webkitAudioContext)(); } if(audioCtx.state === 'suspended') audioCtx.resume(); }

        // --- 1. Burn-in ---
        let burnNode, burnInterval, isBurnIn = false;
        let noiseType = 'pink'; let targetTime = 0; let startTime = 0;

        function setNoise(t) {
            noiseType = t;
            ['n-pink','n-white','n-brown'].forEach(id => document.getElementById(id).classList.remove('active'));
            document.getElementById(`n-${t}`).classList.add('active');
            if(isBurnIn) { toggleBurnIn(); toggleBurnIn(); }
        }
        function setTimer(m) {
            targetTime = m;
            ['t-0','t-15','t-30','t-60','t-120'].forEach(id => document.getElementById(id).classList.remove('active'));
            document.getElementById(`t-${m}`).classList.add('active');
            document.getElementById('timer-status').textContent = m===0 ? "TARGET: INFINITE" : `TARGET: ${m} MIN`;
        }
        function createNoise(t) {
            const bS = 4096; const node = audioCtx.createScriptProcessor(bS, 1, 1);
            let b0=0,b1=0,b2=0,b3=0,b4=0,b5=0,b6=0, lo=0;
            node.onaudioprocess = function(e) {
                const o = e.outputBuffer.getChannelData(0);
                for(let i=0; i<bS; i++) {
                    const w = Math.random()*2-1;
                    if(t==='white') o[i]=w*0.1;
                    else if(t==='brown') { lo=(lo+(0.02*w))/1.02; o[i]=lo*3.5; }
                    else { b0=0.99886*b0+w*0.0555179; b1=0.99332*b1+w*0.0750759; b2=0.969*b2+w*0.153852; b3=0.8665*b3+w*0.3104856; b4=0.55*b4+w*0.5329522; b5=-0.7616*b5-w*0.016898; o[i]=(b0+b1+b2+b3+b4+b5+b6+w*0.5362)*0.11; b6=w*0.115926; }
                }
            };
            return node;
        }
        function toggleBurnIn() {
            initAudio(); const btn = document.getElementById('burnin-btn'); const panel = document.getElementById('burnin-panel');
            if(isBurnIn) {
                if(burnNode) { burnNode.disconnect(); burnNode=null; }
                isBurnIn = false; clearInterval(burnInterval);
                btn.classList.replace('btn-primary', 'btn-secondary'); document.getElementById('burnin-text').textContent = "ã‚¨ãƒ¼ã‚¸ãƒ³ã‚°é–‹å§‹";
                panel.classList.remove('scanning'); document.getElementById('burnin-vis').classList.remove('active');
            } else {
                burnNode = createNoise(noiseType); burnNode.connect(audioCtx.destination); isBurnIn = true;
                startTime = Date.now();
                burnInterval = setInterval(()=>{
                    const e = Math.floor((Date.now()-startTime)/1000);
                    const h=Math.floor(e/3600), m=Math.floor((e%3600)/60), s=e%60;
                    document.getElementById('timer-display').textContent = `${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
                    if(targetTime>0 && e>=targetTime*60) { toggleBurnIn(); alert('Completed'); }
                }, 1000);
                btn.classList.replace('btn-secondary', 'btn-primary'); document.getElementById('burnin-text').textContent = "åœæ­¢";
                panel.classList.add('scanning'); document.getElementById('burnin-vis').classList.add('active');
            }
        }
        const vis = document.getElementById('burnin-vis'); for(let i=0;i<30;i++){const d=document.createElement('div');d.className='v-bar';d.style.height='4px';vis.appendChild(d);}
        function animVis(){ if(isBurnIn) document.querySelectorAll('.v-bar').forEach(b=>b.style.height=Math.random()*30+4+'px'); requestAnimationFrame(animVis); } animVis();

        // --- 2. Range Test ---
        let toneOsc, isTone=false, isSweep=false, sweepInt;
        function updateFreq(v) {
            const f = parseInt(v); document.getElementById('freq-display').innerHTML=`${f.toLocaleString()}<span class="text-2xl ml-2 text-brand-muted">Hz</span>`;
            if(isTone && toneOsc) toneOsc.frequency.setValueAtTime(f, audioCtx.currentTime);
        }
        function toggleTone() {
            if(isSweep) toggleSweep(); initAudio();
            const btn = document.getElementById('tone-btn');
            if(isTone) { toneOsc.stop(); isTone=false; btn.classList.replace('btn-primary','btn-secondary'); document.getElementById('tone-text').textContent="ãƒˆãƒ¼ãƒ³å†ç”Ÿ"; }
            else { toneOsc=audioCtx.createOscillator(); const g=audioCtx.createGain(); toneOsc.type='sine'; toneOsc.frequency.value=document.getElementById('freq-slider').value; g.gain.value=0.1; toneOsc.connect(g); g.connect(audioCtx.destination); toneOsc.start(); isTone=true; btn.classList.replace('btn-secondary','btn-primary'); document.getElementById('tone-text').textContent="åœæ­¢"; }
        }
        function toggleSweep() {
            if(isTone) toggleTone(); initAudio(); const btn = document.getElementById('sweep-btn');
            if(isSweep) { if(toneOsc){toneOsc.stop(); toneOsc=null;} clearInterval(sweepInt); isSweep=false; btn.classList.remove('bg-blue-500','text-white'); btn.classList.add('bg-blue-500/10','text-blue-300'); document.getElementById('sweep-text').textContent="Auto Sweep"; }
            else {
                toneOsc=audioCtx.createOscillator(); const g=audioCtx.createGain(); toneOsc.type='sine'; toneOsc.frequency.value=20; g.gain.value=0.1; toneOsc.connect(g); g.connect(audioCtx.destination); toneOsc.start(); isSweep=true;
                btn.classList.remove('bg-blue-500/10','text-blue-300'); btn.classList.add('bg-blue-500','text-white'); document.getElementById('sweep-text').textContent="ã‚¹ã‚¤ãƒ¼ãƒ—ä¸­...";
                let sF=20, eF=20000, dur=10000, sT=Date.now();
                sweepInt = setInterval(()=>{
                    let el = Date.now()-sT; if(el>=dur) { toggleSweep(); return; }
                    let f = sF * Math.pow(eF/sF, el/dur); toneOsc.frequency.setValueAtTime(f, audioCtx.currentTime);
                    document.getElementById('freq-slider').value=f; updateFreq(f);
                },20);
            }
        }
        function unlockHiRes() {
            const s=document.getElementById('freq-slider'), b=document.getElementById('unlock-btn'), l=document.getElementById('freq-labels');
            if(s.max==20000) { s.max=50000; b.innerHTML='<i data-lucide="lock" class="w-3 h-3"></i> é€šå¸¸ãƒ¢ãƒ¼ãƒ‰'; b.classList.add('bg-[#00dc82]/10'); l.innerHTML=`<span>20</span><span>1k</span><span>10k</span><span>20k</span><span class="text-[#00dc82]">50k</span>`; }
            else { s.max=20000; if(s.value>20000) {s.value=20000; updateFreq(20000);} b.innerHTML='<i data-lucide="zap" class="w-3 h-3"></i> é«˜ç´šã‚¤ãƒ¤ãƒ›ãƒ³è‡ªæ…¢ãƒ¢ãƒ¼ãƒ‰'; b.classList.remove('bg-[#00dc82]/10'); l.innerHTML=`<span>20</span><span>100</span><span>1k</span><span>10k</span><span>20k</span>`; }
            lucide.createIcons();
        }

        // --- 3. Stereo & 3D ---
        let stOsc, panOsc, isPan = false;
        let spatialOsc, spatialGain, spatialPanner, isDragging = false;
        let soundType = 'pulse';

        function playStereo(side) {
            initAudio(); let o=audioCtx.createOscillator(); let g=audioCtx.createGain(); let p=audioCtx.createStereoPanner();
            o.type='sine'; o.frequency.value=440; g.gain.value=0.1; p.pan.value=(side==='left'?-1:(side==='right'?1:0));
            o.connect(g); g.connect(p); p.connect(audioCtx.destination); o.start();
            setTimeout(()=>{ g.gain.linearRampToValueAtTime(0, audioCtx.currentTime+0.1); o.stop(audioCtx.currentTime+0.1); }, 300);
        }

        function startPanning() {
            initAudio();
            const btn = document.getElementById('pan-btn');
            const ind = document.getElementById('pan-indicator');
            if(isPan) {
                panOsc.stop(); panOsc=null; isPan=false;
                btn.classList.replace('btn-primary', 'btn-secondary');
                document.getElementById('pan-text').textContent = 'å®šä½ç§»å‹•ãƒ†ã‚¹ãƒˆ (L â†” R)';
                ind.style.opacity = 0;
            } else {
                panOsc = audioCtx.createOscillator();
                const g = audioCtx.createGain();
                const p = audioCtx.createStereoPanner();
                panOsc.frequency.value = 800; g.gain.value = 0.1;
                panOsc.connect(g); g.connect(p); p.connect(audioCtx.destination);
                panOsc.start();
                
                isPan = true;
                btn.classList.replace('btn-secondary', 'btn-primary');
                document.getElementById('pan-text').textContent = 'åœæ­¢';
                ind.style.opacity = 1;
                
                let start = audioCtx.currentTime;
                function loop() {
                    if(!isPan) return;
                    let pos = Math.sin((audioCtx.currentTime - start) * 2);
                    p.pan.value = pos;
                    ind.style.left = ((pos + 1) / 2 * 100) + '%';
                    requestAnimationFrame(loop);
                }
                loop();
            }
        }

        function toggleSurround() {
            const panel = document.getElementById('surround-panel');
            const btn = document.getElementById('surround-btn');
            if(panel.classList.contains('hidden')) {
                panel.classList.remove('hidden');
                btn.innerHTML = '<i data-lucide="chevron-up" class="w-4 h-4"></i> Close 3D Test';
                btn.classList.add('bg-purple-500/20', 'text-purple-300');
            } else {
                panel.classList.add('hidden');
                btn.innerHTML = '<i data-lucide="aperture" class="w-4 h-4"></i> Unlock 3D Spatial Audio';
                btn.classList.remove('bg-purple-500/20', 'text-purple-300');
            }
            lucide.createIcons();
        }

        function setSoundSource(type) {
            soundType = type;
            ['btn-pulse','btn-footstep','btn-gunshot'].forEach(id => document.getElementById(id).classList.remove('active'));
            document.getElementById(`btn-${type}`).classList.add('active');
        }

        function createSource() {
            if(soundType === 'pulse') {
                const osc = audioCtx.createOscillator(); osc.type = 'sine'; osc.frequency.value = 440;
                const lfo = audioCtx.createOscillator(); lfo.type = 'square'; lfo.frequency.value = 8;
                const am = audioCtx.createGain(); osc.connect(am); lfo.connect(am.gain); lfo.start(); osc.start(); return am;
            } else if(soundType === 'footstep') {
                const bSize = audioCtx.sampleRate * 2; const buf = audioCtx.createBuffer(1, bSize, audioCtx.sampleRate); const d = buf.getChannelData(0);
                for(let i=0; i<bSize; i++) { const t = i/audioCtx.sampleRate; if(t%0.6<0.1) d[i]=(Math.random()*2-1)*0.5; else d[i]=0; }
                const src = audioCtx.createBufferSource(); src.buffer = buf; src.loop = true; const f = audioCtx.createBiquadFilter(); f.type='lowpass'; f.frequency.value=400; src.connect(f); src.start(); return f;
            } else {
                const bSize = audioCtx.sampleRate; const buf = audioCtx.createBuffer(1, bSize, audioCtx.sampleRate); const d = buf.getChannelData(0);
                for(let i=0; i<bSize; i++) { const t = i/audioCtx.sampleRate; if(t<0.2) d[i]=(Math.random()*2-1)*(1-t/0.2); else d[i]=0; }
                const src = audioCtx.createBufferSource(); src.buffer = buf; src.loop = true; src.start(); return src;
            }
        }

        function startDrag(e) {
            e.preventDefault(); isDragging = true; initAudio();
            const src = createSource();
            spatialGain = audioCtx.createGain(); spatialGain.gain.value = 0.3;
            spatialPanner = new PannerNode(audioCtx, { panningModel: 'HRTF' });
            src.connect(spatialGain); spatialGain.connect(spatialPanner); spatialPanner.connect(audioCtx.destination);
            spatialOsc = src;
            updatePosition(e.touches?e.touches[0].clientX:e.clientX, e.touches?e.touches[0].clientY:e.clientY);
            updateElevation(document.getElementById('elevation-slider').value);
        }

        function drag(e) { if(!isDragging) return; e.preventDefault(); updatePosition(e.touches?e.touches[0].clientX:e.clientX, e.touches?e.touches[0].clientY:e.clientY); }
        function endDrag() { if(!isDragging) return; isDragging = false; if(spatialGain) spatialGain.gain.linearRampToValueAtTime(0, audioCtx.currentTime+0.1); setTimeout(()=>{ if(spatialOsc) { try{spatialOsc.stop()}catch(e){} spatialOsc=null; } }, 100); }

        function updatePosition(cx, cy) {
            const r = document.getElementById('radar-area'); const rect = r.getBoundingClientRect();
            const x = cx - rect.left; const y = cy - rect.top;
            let nx = (x/rect.width)*2-1; let nz = (y/rect.height)*2-1;
            const d = Math.sqrt(nx*nx+nz*nz); if(d>1) { nx/=d; nz/=d; }
            document.getElementById('sound-point').style.left = `${(nx+1)/2*100}%`;
            document.getElementById('sound-point').style.top = `${(nz+1)/2*100}%`;
            if(spatialPanner) { spatialPanner.positionX.value = nx*5; spatialPanner.positionZ.value = nz*5; }
        }

        function updateElevation(v) {
            const y = parseFloat(v);
            document.getElementById('elevation-thumb').style.bottom = `${(y+1)/2*100}%`;
            if(spatialPanner) spatialPanner.positionY.value = y*5;
        }

        // Affiliate
        const recC = document.getElementById('rec-container');
        [{name:"Sennheiser IE 200",kw:"Sennheiser IE 200",p:"Â¥23,000",d:"åŸéŸ³å†ç”Ÿã®åŸºæº–æ©Ÿ"},{name:"Sony WH-1000XM5",kw:"Sony WH-1000XM5",p:"Â¥48,000",d:"æœ€å¼·ãƒã‚¤ã‚­ãƒ£ãƒ³"},{name:"Moondrop Aria 2",kw:"Moondrop Aria 2",p:"Â¥13,500",d:"ä¸­è¯ã‚¤ãƒ¤ãƒ›ãƒ³ã®å‚‘ä½œ"}].forEach(i=>{
            const u = `https://www.amazon.co.jp/s?k=${encodeURIComponent(i.kw)}&tag=${AFFILIATE_ID}`;
            recC.innerHTML += `<a href="${u}" target="_blank" class="flex items-center justify-between p-4 bg-white/5 border border-white/10 rounded-xl hover:border-[#00dc82]/50 transition-all group"><div class="text-left"><div class="font-bold text-white group-hover:text-[#00dc82] transition-colors">${i.name}</div><div class="text-xs text-brand-muted">${i.d}</div></div><div class="text-right flex flex-col items-end"><div class="text-xs font-mono text-brand-muted mb-1">${i.p}</div><i data-lucide="external-link" class="w-4 h-4 text-white"></i></div></a>`;
        });

        function shareResult() {
            const url = "https://Art2020k.github.io/Gadget/EarphoneLab.html";
            window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent("ã€Earphone Labã€‘ã‚¤ãƒ¤ãƒ›ãƒ³ã®æ¥µé™ãƒ†ã‚¹ãƒˆå®Ÿæ–½ä¸­...ğŸ§\n#ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªãƒã‚§ãƒƒã‚¯")}&url=${encodeURIComponent(url)}`, '_blank');
        }
    </script>
</body>
</html>